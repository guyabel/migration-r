<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Handling, Measuring, Estimating and Visualizing Migration Data in R - 6&nbsp; Migration Age Schedules</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./04-indices.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-age.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Migration Age Schedules</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Handling, Measuring, Estimating and Visualizing Migration Data in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Migration Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Handling Migration Data in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-net.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Net Migration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-indices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Summary Migration Indices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-age.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Migration Age Schedules</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#rogers-castro-migration-age-schedules" id="toc-rogers-castro-migration-age-schedules" class="nav-link active" data-scroll-target="#rogers-castro-migration-age-schedules"><span class="header-section-number">6.1</span> Rogers Castro migration age schedules</a></li>
  <li><a href="#model-migration-age-schedules" id="toc-model-migration-age-schedules" class="nav-link" data-scroll-target="#model-migration-age-schedules"><span class="header-section-number">6.2</span> Model migration age schedules</a></li>
  <li><a href="#fitting-roger-castro-migration-age-schedules" id="toc-fitting-roger-castro-migration-age-schedules" class="nav-link" data-scroll-target="#fitting-roger-castro-migration-age-schedules"><span class="header-section-number">6.3</span> Fitting Roger Castro migration age schedules</a></li>
  <li>
<a href="#smoothing" id="toc-smoothing" class="nav-link" data-scroll-target="#smoothing"><span class="header-section-number">6.4</span> Smoothing</a>
  <ul class="collapse">
<li><a href="#kernal-smoothing" id="toc-kernal-smoothing" class="nav-link" data-scroll-target="#kernal-smoothing"><span class="header-section-number">6.4.1</span> Kernal Smoothing</a></li>
  <li><a href="#loess-smoothing" id="toc-loess-smoothing" class="nav-link" data-scroll-target="#loess-smoothing"><span class="header-section-number">6.4.2</span> Loess Smoothing</a></li>
  <li><a href="#cubic-spline-smoothing" id="toc-cubic-spline-smoothing" class="nav-link" data-scroll-target="#cubic-spline-smoothing"><span class="header-section-number">6.4.3</span> Cubic Spline smoothing</a></li>
  </ul>
</li>
  <li><a href="#graduating" id="toc-graduating" class="nav-link" data-scroll-target="#graduating"><span class="header-section-number">6.5</span> Graduating</a></li>
  <li>
<a href="#migraiton-age-indices" id="toc-migraiton-age-indices" class="nav-link" data-scroll-target="#migraiton-age-indices"><span class="header-section-number">6.6</span> Migraiton Age Indices</a>
  <ul class="collapse">
<li><a href="#rogers-and-castro-parameter-relationships" id="toc-rogers-and-castro-parameter-relationships" class="nav-link" data-scroll-target="#rogers-and-castro-parameter-relationships"><span class="header-section-number">6.6.1</span> Rogers and Castro Parameter Relationships</a></li>
  <li><a href="#emprical-age-indices" id="toc-emprical-age-indices" class="nav-link" data-scroll-target="#emprical-age-indices"><span class="header-section-number">6.6.2</span> Emprical Age Indices</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Migration Age Schedules</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Age plays a crucial role in shaping migration patterns and rates, and it is a significant source of heterogeneity in migration behavior. Migration rates can differ substantially across different age groups. Young adults often exhibit higher migration rates compared to other age cohorts. This is commonly observed due to factors such as educational pursuits and employment opportunities. Some older adults may migrate for retirement purposes, seeking locations with favorable climates, amenities, or healthcare facilities. Others may migrate to be closer to family members or to access specific social support networks. Furthermore, age can interact with other demographic characteristics, such as marital status or family composition, to influence migration decisions. For example, young adults who are married or have children may consider different factors when deciding to migrate compared to single individuals or couples without children.</p>
<section id="rogers-castro-migration-age-schedules" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="rogers-castro-migration-age-schedules">
<span class="header-section-number">6.1</span> Rogers Castro migration age schedules</h2>
<p>As with other demographic events such as fertility and mortality, migration exhibit consistent patterns in their age-specific rates. Demographers have dedicated efforts to capturing and summarizing these regularities in rates using mathematical expressions known as model schedules. These model schedules aim to provide a concise representation of the age-specific migration rates based on empirical data.</p>
<p>Model migration age schedules are used for several purposes in demographic analysis and population studies. They commonly provide a basis for projecting and forecasting future migration patterns in cohort component population projection models. This can be to smooth age-specific migration baseline data which might be unreliable. When no age-specific migration data is available, model migration age schedules can be used to derive age-specific migration patterns required for cohort component population projection models. Fitted parameters in model migration age schedules can also be used to analyze and compare the age-specific migration patterns in different populations, identifying similarities and differences.</p>
<p><span class="citation" data-cites="Rogers1981">(<a href="references.html#ref-Rogers1981" role="doc-biblioref"><strong>Rogers1981?</strong></a>)</span> were the first to identify and mathematically summarise the consistency in migraiton age patterns after a comprehensive analysis of more than 500 age profiles of migration. Rogers-Castro migration age schedule are composed of intersecting mathematical curves representing migration patterns across different life stages. The curves in different parts of the schedule aims to capture the age-specific migration rates within specific segments of the population. The schedules are divided into five main components:</p>
<ol type="1">
<li><p>Pre-labor force: This curve represents migration patterns among individuals who have not yet entered the labor force, such as children, students or young individuals who have not yet started working. Higher migration rates tend to found in very young adolescents who move with their parents.</p></li>
<li><p>Labor force: This curve focuses on migration patterns among individuals who are actively engaged in the labor force. It captures migration behavior among working-age individuals, reflecting factors such as job opportunities, economic conditions, and career advancements which tend to peak in early adulthood and then gradually decline until retiremnet.</p></li>
<li><p>Post-labor force: This curve accounts for migration patterns among individuals who have exited the labor force, such as retirees. Upon exiting the labour force, indivudals might migrate as they no longer need to be located near their working location.</p></li>
<li><p>Post-retirement: This component specifically addresses migration patterns among individuals who are towards the later stages of their life course and might migrate for better access to healthcare and proximity to family or social networks for later life care.</p></li>
<li><p>Constant term: This term represents a constant or baseline level of migration that is independent of age.</p></li>
</ol>
<p>Each of these componets can be represented mathematically using algebraic expression for cureves describing the changes in migration rates <span class="math inline">\(m\)</span> for each age group <span class="math inline">\(x\)</span> and combined as:</p>
<p><span class="math display">\[
\begin{aligned}
m(x) =&amp; a_1 \exp(-\alpha_1 x)  \\
&amp;+a_2 \exp(-\alpha_2(x - \mu_2) - \exp(\lambda_2(x - \mu_2)))  \\
&amp;+a_3 \exp(-\alpha_3(x - \mu_3) - \exp(\lambda_3(x - \mu_3)))  \\
&amp;+a_4 \exp(\lambda_4x)\\
&amp;+ c
\end{aligned}
\]</span></p>
<p>By combining the components, the Rogers-Castro migration age schedules provide a framework for describing age-specific migration patterns across different life stages. In many locations and time periods, not all of the components of the full migration age schedule are relevant.</p>
<p>Almost all migration age patterns exhibit certain a downward slope during the pre-labor force years and a peak during the labor force period. To capture these patterns, only a 7-parameter model schedule, without the additional algebraic expressions for the post-labour and post-retirement components (based on the <span class="math inline">\(a3, a4, \alpha_3, \mu_3, \lambda_3 and \lambda_4\)</span>$) are used.</p>
<p>In specific areas, particularly in more elderly Western countries, migration age patterns may exhibit the additional retirement peak components, which leads to an 11-parameter model schedule that includes the pre-labor force and labor force components. In contrast, in some regions, instead of a retirement peak, age profiles exhibit an upward slope towards the end of life, which leads to a 9-parameter model schedule. In rare cases, there are instances where both a retirement peak and a post-retirement upward slope are observed in migration age patterns, captured by the full 13-parameter model schedule, proposed by <span class="citation" data-cites="Rogers1987a">(<a href="references.html#ref-Rogers1987a" role="doc-biblioref"><strong>Rogers1987a?</strong></a>)</span>. Further refinements to the migration model age schedules have since been proposed, including by <span class="citation" data-cites="Wilson2010">(<a href="references.html#ref-Wilson2010" role="doc-biblioref"><strong>Wilson2010?</strong></a>)</span>, who introduced a 17-parameter model that incorporates a student peak before the labor force peak. This addition acknowledges the migration patterns observed among students, who may migrate for educational purposes before entering the labor force.</p>
<p>The <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_calculate_rc.html">mig_calculate_rc()</a></code> function in the <em>rcbayes</em> package by <span class="citation" data-cites="Alexander2021">(<a href="references.html#ref-Alexander2021" role="doc-biblioref"><strong>Alexander2021?</strong></a>)</span> provide a quick method to calculate migration age schedules for a given parameter set</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-1_0c6d87f4f3b8f770e92b54f01366b6ec">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rcbayes</span><span class="op">)</span></span>
<span><span class="co"># define 7 parameters</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a1 <span class="op">=</span> <span class="fl">0.1</span>, alpha1 <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>       a2 <span class="op">=</span> <span class="fl">0.2</span>, alpha2 <span class="op">=</span> <span class="fl">0.1</span>, mu2 <span class="op">=</span> <span class="fl">20</span>, lambda2 <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>       c <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate model migration schedule with 11 parameters</span></span>
<span><span class="va">mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rcbayes/man/mig_calculate_rc.html">mig_calculate_rc</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, pars <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="co"># first 10 mx</span></span>
<span><span class="va">mx</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.10048374 0.09187308 0.08408182 0.07703200 0.07065307 0.06488116
 [7] 0.05965853 0.05493290 0.05065697 0.04678794</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot the calculated  mx</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>       mx <span class="op">=</span> <span class="va">mx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">mx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="model-migration-age-schedules" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="model-migration-age-schedules">
<span class="header-section-number">6.2</span> Model migration age schedules</h2>
<p>Model migration schedules play a crucial role in situations where age-specific migration data is unavailable but necessary. One such scenario is in cohort component projections, where age-specific migration rates are essential but might not be readily accessible due to the lack of statistical infrastructure to monitor detailed migration patterns.</p>
<p>To overcome this challenge, researchers can utilize model migration schedules as a practical solution. By leveraging an estimate or reported data on total migration and adopting a model age schedule it becomes possible to derive age-specific migration rates using a standardized form of the age schedule to dissagregate the totals. The selection process of the model age schedule involves the careful selection based on existing knowledge of migration age patterns for the specific population or flow under investigation.</p>
<p>The <em>migest</em> package includes the <code>rc_model_fund</code> data frame with a set of fundamental parameters proposed by <span class="citation" data-cites="Rogers1981">(<a href="references.html#ref-Rogers1981" role="doc-biblioref"><strong>Rogers1981?</strong></a>)</span>, designed to represent a typical migration age pattern from their analysis. Containing only seven parameters, they do not include additional curves for the post-labor force phase and post-retirement peak. We can use the <code><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe()</a></code> function to convert the data frame <code>rc_model_fund</code> into an named vector for use in the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_calculate_rc.html">mig_calculate_rc()</a></code> to calculate the age specific migration rates for a given set of ages</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-2_4057dcef1b9e12d4b677278c2cbe05dc">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://guyabel.github.io/migest/">migest</a></span><span class="op">)</span></span>
<span><span class="va">rc_model_fund</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  param    value
  &lt;chr&gt;    &lt;dbl&gt;
1 a1       0.02 
2 alpha1   0.1  
3 a2       0.06 
4 alpha2   0.1  
5 mu2     20    
6 lambda2  0.4  
7 c        0.003</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert data frame to named vector</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="va">rc_model_fund</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     a1  alpha1      a2  alpha2     mu2 lambda2       c 
  2e-02   1e-01   6e-02   1e-01   2e+01   4e-01   3e-03 </code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calculate and plot age schedule based on fundamental parameters </span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, </span>
<span>       mx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rcbayes/man/mig_calculate_rc.html">mig_calculate_rc</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="va">x</span>, pars <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">mx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <span class="citation" data-cites="UnitedNations1992">(<a href="references.html#ref-UnitedNations1992" role="doc-biblioref"><strong>UnitedNations1992?</strong></a>)</span> proposed a number of alternative sets of parameter values to seven-parameter model age schedules in settings outside of the Western-country populations used by <span class="citation" data-cites="Rogers1981">(<a href="references.html#ref-Rogers1981" role="doc-biblioref"><strong>Rogers1981?</strong></a>)</span> when designing their fundamental parameter set. These parameters are provided in the <code>rc_model_un</code> data frame</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-3_d05ca4baa172947b5daab5ed68deb386">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rc_model_un</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84 × 5
   schedule         schedule_abb sex   param     value
   &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 Western standard ws           male  a1       0.0215
 2 Western standard ws           male  alpha1   0.105 
 3 Western standard ws           male  a2       0.0694
 4 Western standard ws           male  alpha2   0.112 
 5 Western standard ws           male  mu2     20.0   
 6 Western standard ws           male  lambda2  0.391 
 7 Western standard ws           male  c        0.0028
 8 Low dependency   ld           male  a1       0.0128
 9 Low dependency   ld           male  alpha1   0.105 
10 Low dependency   ld           male  a2       0.0804
# … with 74 more rows</code></pre>
</div>
</div>
<p>To apply the parameters to the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_calculate_rc.html">mig_calculate_rc()</a></code> function we can use the <code><a href="https://tidyr.tidyverse.org/reference/nest.html">nest()</a></code> function to group together the parameters into separate tibbles by sex and population settings.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-4_c380d8e1c258df4a631e38cda8c4a336">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">rc_model_un</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">schedule_abb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span>rc_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">param</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">rc_param</span>, .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         mx <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">p</span>, </span>
<span>                  .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/rcbayes/man/mig_calculate_rc.html">mig_calculate_rc</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, pars <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 6
   schedule                              sex    rc_param p         mx     age   
   &lt;chr&gt;                                 &lt;chr&gt;  &lt;list&gt;   &lt;list&gt;    &lt;list&gt; &lt;list&gt;
 1 Western standard                      male   &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 2 Low dependency                        male   &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 3 High dependency                       male   &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 4 Young labour force entry              male   &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 5 Old labour force entry                male   &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 6 Low dependency low labour force entry male   &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 7 Western standard                      female &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 8 Low dependency                        female &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
 9 High dependency                       female &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
10 Young labour force entry              female &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
11 Old labour force entry                female &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; 
12 Low dependency low labour force entry female &lt;tibble&gt; &lt;dbl [7]&gt; &lt;dbl&gt;  &lt;int&gt; </code></pre>
</div>
</div>
<p>Once we have used the <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> function to estimate the model migration age schedules for ages 1 to 80 using the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_calculate_rc.html">mig_calculate_rc()</a></code> function we create a data base varying by age for each model schedule and sex for plotting to get a better idea of how each migraiton schedule operates for each sex and population</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-5_0ad246f4b8f7dc8cedd2be8da09f72e1">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mx</span>, <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>schedule <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">schedule</span>, width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mx</span>, colour <span class="op">=</span> <span class="va">schedule</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span>facets <span class="op">=</span> <span class="st">"sex"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notable from the plot is the later peak age of migration in the older labour force entry age schedules, compared to the Western Standard age schedule that has parameters very close to those proposed by <span class="citation" data-cites="Rogers1981">(<a href="references.html#ref-Rogers1981" role="doc-biblioref"><strong>Rogers1981?</strong></a>)</span>. For populations with younger labour force entry the peak age of migration shifts leftwards, whilst it increases for populations with low old age dependencies and decreases populations with high old age dependencies.</p>
<p>It is worth noting again, that the typical use of model age schedules might be when we do not know any age-specific migration rates but soley a migration total, where the migration total might be a projected or forecasted value. In such a case we might first select an appropriate model schedule from <code>rc_model_un</code></p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-6_c17cf75e6debf9bb6a382553a2bc6e7f">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># example for males based on young labour force entry</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">rc_model_un</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span>, <span class="va">schedule_abb</span> <span class="op">==</span> <span class="st">"ylfe"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     a1  alpha1      a2  alpha2     mu2 lambda2       c 
 0.0215  0.1050  0.0691  0.1120 16.0900  0.3910  0.0028 </code></pre>
</div>
</div>
<p>We may then calculate the age-specific migration using the parameter values to generate a standardized model age schedule (where the calculated <span class="math inline">\(m(x)\)</span> values sum to one) using the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_calculate_rc.html">mig_calculate_rc()</a></code> function. The standardized values can the be multiplied by a total estimate to get the age-specific migration counts, which might be converted to rates given the appropriate denominator.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-7_0c556ba5bdc96fd0fe4f355f9ecde60c">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">90</span>, </span>
<span>       mx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rcbayes/man/mig_calculate_rc.html">mig_calculate_rc</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="va">x</span>, pars <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,</span>
<span>       <span class="co"># calculate number of migrants, given a total estimate of 10,000</span></span>
<span>       Mx <span class="op">=</span> <span class="fl">10000</span> <span class="op">*</span> <span class="va">mx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">Mx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="fitting-roger-castro-migration-age-schedules" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="fitting-roger-castro-migration-age-schedules">
<span class="header-section-number">6.3</span> Fitting Roger Castro migration age schedules</h2>
<p>When we have age-specific migration data, we may be interested in estimating the parameters of a Rogers Castro age schedule. Estimating these parameters serves several purposes:</p>
<ol type="1">
<li><p>Smoothing the data: By fitting a Rogers Castro age schedule to age-specific migration data, we can obtain a smoothed representation of the migration pattern. This can help in reducing the noise in the data that might be generated from difficulties in collecting data on the number of migrants entering or leaving a region or country.</p></li>
<li><p>Comparing parameter estimates: Estimating the parameters of a Rogers Castro age schedule allows us to compare migration patterns between different time periods or migration streams. By examining the differences in parameter estimates, we can gain insights into changes or variations in the age-specific migration patterns. We will further explore the interpretation of parameter estimates of the Rogers-Castro fitted age schedules in the next section.</p></li>
<li><p>Creating age schedules for projected migration: Once we have estimated the parameters of the age schedule, we can use these estimates to project future migration patterns based on past patterns of the age schedule parameters or using the smoothed values from the fitted model migration age schedule.</p></li>
</ol>
<p>Fitting Rogers Castro migration age schedules has long be a difficult challenge due to the relatively small amount of data (based on the number age groups) and the relatively complexity of the migration age schedules. Various code and software tools have been used including FORTAN code in <span class="citation" data-cites="Rogers1994">(<a href="references.html#ref-Rogers1994" role="doc-biblioref"><strong>Rogers1994?</strong></a>)</span>, the TableCurve 2D software <span class="citation" data-cites="Rogers1999a">(<a href="references.html#ref-Rogers1999a" role="doc-biblioref"><strong>Rogers1999a?</strong></a>)</span>, MATLAB code used by <span class="citation" data-cites="Rogers2010">(<a href="references.html#ref-Rogers2010" role="doc-biblioref"><strong>Rogers2010?</strong></a>)</span>, and VBA code for Excel <span class="citation" data-cites="Wilson2010">(<a href="references.html#ref-Wilson2010" role="doc-biblioref"><strong>Wilson2010?</strong></a>)</span>. Three alternative linear parameter estimation methods were provided by <span class="citation" data-cites="Rogers2005">(<a href="references.html#ref-Rogers2005" role="doc-biblioref"><strong>Rogers2005?</strong></a>)</span></p>
<p>Fortunately, the <em>rcbayes</em> package provides a <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function that provides far better performance and flexibility than its predecessors. The <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function calls Stan, a Bayesian probabilistic programming language, via the <em>rstan</em> package, to estimate the parameters of a Rogers Castro age schedule. The estimation process is performed using a powerful Bayesian sampling techniques to estimate the of parameter in a range of Rogers-Castro migration age schedules and their full posterior distributions to quantify the uncertainty of the estimates.</p>
<p>To use the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function, two arguments are required:</p>
<ol type="1">
<li>
<code>ages</code>: A vector of migration ages, representing the age groups for which we have migration data.</li>
<li>
<code>mx</code>: A vector of standardized migration intensities corresponding to the ages in the <code>ages</code> vector. or</li>
<li>
<code>migrants</code> and <code>pop</code>: Two vectors of migrant and population counts to calculate the age specific migration rates.</li>
</ol>
<p>Additionally, the form of the age schedule can be specified using the <code>pre_working_age</code>, <code>working_age</code>, <code>retirement</code>, and <code>post_retirement</code> arguments, which can be set to <code>TRUE</code> or <code>FALSE</code> depending on the desired structure of the age schedule.</p>
<p>To demonstrate we will use data for immigration age-specific immigration flows into Cyprus during 2011 published by Eurostat. These can be downloaded using the <em>eurostat</em> package:</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-8_75cdc19fab27690bfaa78640634efc04">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropengov.github.io/eurostat/">eurostat</a></span><span class="op">)</span></span>
<span><span class="co"># all age-sex specific immigration data</span></span>
<span><span class="va">imm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ropengov.github.io/eurostat/reference/get_eurostat.html">get_eurostat</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"migr_imm8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter to cyprus 2011</span></span>
<span><span class="va">imm_cy_2011</span> <span class="op">&lt;-</span> <span class="va">imm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">geo</span> <span class="op">==</span> <span class="st">"CY"</span>,</span>
<span>         <span class="va">age</span> <span class="op">!=</span> <span class="st">"TOTAL"</span>,</span>
<span>         <span class="va">age</span> <span class="op">!=</span> <span class="st">"UNK"</span>,</span>
<span>         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"T"</span>,</span>
<span>         <span class="va">time</span> <span class="op">==</span> <span class="st">"2011-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># format age column to numeric values</span></span>
<span><span class="va">imm_cy_2011</span> <span class="op">&lt;-</span> <span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">age</span>, pattern <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">age</span> <span class="op">==</span> <span class="st">"_LT1"</span> <span class="op">~</span> <span class="st">"0"</span>,</span>
<span>      <span class="va">age</span> <span class="op">==</span> <span class="st">"_GE100"</span> <span class="op">~</span> <span class="st">"101"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">age</span></span>
<span>    <span class="op">)</span>, </span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">imm_cy_2011</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 162 × 7
   agedef   age unit  sex   geo   time       values
   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt;      &lt;dbl&gt;
 1 REACH      1 NR    F     CY    2011-01-01    130
 2 REACH      1 NR    M     CY    2011-01-01    136
 3 REACH     10 NR    F     CY    2011-01-01     88
 4 REACH     10 NR    M     CY    2011-01-01    102
 5 REACH     11 NR    F     CY    2011-01-01     97
 6 REACH     11 NR    M     CY    2011-01-01     89
 7 REACH     12 NR    F     CY    2011-01-01     89
 8 REACH     12 NR    M     CY    2011-01-01     79
 9 REACH     13 NR    F     CY    2011-01-01     65
10 REACH     13 NR    M     CY    2011-01-01     73
# … with 152 more rows</code></pre>
</div>
</div>
<p>We can see that the data do appear to not entirely smooth. This may be due to random variations in migration patterns of relatively small counts of migration. However, it would not be ideal to use the raw data as underlying assumption for the distribution of age-specific migration in a cohort component population projection model as there is clear justification for believing the underlying age migration patterns are non-smooth. For example, to observed migration for 41 year old persons is slightly higher that those that are 40 years old and counter to the declining trend of migration from 30 year old onwards.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-9_c171a3ffc4bc420e239e1ea02152176e">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">values</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The general shape of the observed values indicate that a seven parameter Rogers Castro migration age schedules is appropriate, where is no retirement peak or post-retirement slope are visable.</p>
<p>The <code>mx</code> values required in the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function represent the standardized migration intensities corresponding to the ages in the <code>ages</code> vector, meaning that their sum should be equal to one. This ensures that the migration intensities are properly scaled and reflect the relative proportions of migration within each age group.</p>
<p>When using the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function, it is common to wait for a few minutes during the computation time. Additionally, the function may print out several messages from Stan, with information about the estimation process, including the progress of the MCMC sampling and any convergence diagnostics.</p>
<p>It is recommended to carefully review the messages printed during the estimation process to ensure that the estimation has converged properly and that the results are reliable. The messages can provide insights into the estimation process and help identify any potential issues or concerns.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-10_c9556ed5082bbdd7db5683e9f6c8cf62">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># standardize migration intensity</span></span>
<span><span class="va">imm_cy_2011</span> <span class="op">&lt;-</span> <span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">values</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">imm_cy_2011</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 162 × 8
# Groups:   sex [2]
   agedef   age unit  sex   geo   time       values      mx
   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1 REACH      1 NR    F     CY    2011-01-01    130 0.0102 
 2 REACH      1 NR    M     CY    2011-01-01    136 0.0132 
 3 REACH     10 NR    F     CY    2011-01-01     88 0.00693
 4 REACH     10 NR    M     CY    2011-01-01    102 0.00987
 5 REACH     11 NR    F     CY    2011-01-01     97 0.00763
 6 REACH     11 NR    M     CY    2011-01-01     89 0.00862
 7 REACH     12 NR    F     CY    2011-01-01     89 0.00700
 8 REACH     12 NR    M     CY    2011-01-01     79 0.00765
 9 REACH     13 NR    F     CY    2011-01-01     65 0.00512
10 REACH     13 NR    M     CY    2011-01-01     73 0.00707
# … with 152 more rows</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit seven-parameter rogers castro </span></span>
<span><span class="va">f_cy_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rcbayes/man/mig_estimate_rc.html">mig_estimate_rc</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, </span>
<span>                     mx <span class="op">=</span> <span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">mx</span><span class="op">)</span>,</span>
<span>                     pre_working_age <span class="op">=</span> <span class="cn">TRUE</span>, working_age <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     retirement <span class="op">=</span> <span class="cn">FALSE</span>, post_retirement <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mig_estimate_rc is running normal model, Using arguments ages and mx</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'rcmodel_normal' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 2.346 seconds (Warm-up)
Chain 1:                1.817 seconds (Sampling)
Chain 1:                4.163 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'rcmodel_normal' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 2.339 seconds (Warm-up)
Chain 2:                2.475 seconds (Sampling)
Chain 2:                4.814 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'rcmodel_normal' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 2.862 seconds (Warm-up)
Chain 3:                2.469 seconds (Sampling)
Chain 3:                5.331 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'rcmodel_normal' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 2.919 seconds (Warm-up)
Chain 4:                2.365 seconds (Sampling)
Chain 4:                5.284 seconds (Total)
Chain 4: </code></pre>
</div>
</div>
<p>The <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function returns a <code>list</code> object with three components. In the output of the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function, there are three elements:</p>
<ol type="1">
<li><p><code>pars_df</code>: This is a data frame that contains the parameter estimates along with their 95% credible intervals. The parameter estimates represent the values obtained from the estimation process, while the credible intervals provide a measure of uncertainty around those estimates.</p></li>
<li><p><code>fit_df</code>: This is a data frame that shows the original data and the estimated migration rates at each age.</p></li>
<li><p><code>check_converge</code>: This is a data frame that provides information about the convergence of the estimation process. It includes the R-hat values and effective sample sizes for each parameter. The R-hat values, also known as the Gelman-Rubin statistic, assess the convergence of the MCMC chains used in the estimation. A value close to 1 indicates good convergence. The effective sample sizes indicate the number of independent samples obtained for each parameter, and higher values indicate more reliable estimates.</p></li>
</ol>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-11_8273cf8e5827e3def2cfd1362baf34fd">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameter estimates</span></span>
<span><span class="va">f_cy_male</span><span class="op">$</span><span class="va">pars_df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  variable    median      lower    upper
  &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 a1        0.0119    0.0100     0.0137 
2 a2        0.0591    0.0535     0.0674 
3 alpha1    0.0446    0.0286     0.0682 
4 alpha2    0.0776    0.0681     0.0924 
5 c         0.000599  0.0000267  0.00181
6 lambda2   0.295     0.235      0.358  
7 mu2      21.1      20.5       22.0    </code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fitted schedule</span></span>
<span><span class="va">f_cy_male</span><span class="op">$</span><span class="va">fit_df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 81 × 6
     age    data  median   lower   upper       diff_sq
   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
 1     1 0.0132  0.0120  0.0106  0.0135  0.00000137   
 2    10 0.00987 0.00822 0.00725 0.00911 0.00000273   
 3    11 0.00862 0.00789 0.00687 0.00881 0.000000528  
 4    12 0.00765 0.00758 0.00651 0.00854 0.00000000473
 5    13 0.00707 0.00729 0.00619 0.00828 0.0000000478 
 6    14 0.00687 0.00704 0.00595 0.00806 0.0000000294 
 7    15 0.00552 0.00701 0.00596 0.00805 0.00000223   
 8    16 0.00823 0.00752 0.00642 0.00879 0.000000503  
 9    17 0.00629 0.00917 0.00781 0.0108  0.00000829   
10    18 0.0149  0.0123  0.0106  0.0141  0.00000665   
# … with 71 more rows</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot of observed and fitted age schedule with 95% credible interval</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">f_cy_male</span><span class="op">$</span><span class="va">fit_df</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">median</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="smoothing" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="smoothing">
<span class="header-section-number">6.4</span> Smoothing</h2>
<p>There are many non-parametric smoothing functions that can applied to age-specific migration data to help capturing the underlying patterns by reducing noise and variability in the data. Some commonly used smoothing functions in R are available in the <code>stats</code> package, which is loaded by default when R opens. They can fitted very quickly in comparison to Rogers-Castro model age schedules and do not require any specification on the phases.</p>
<p>Smoothing methods involve weighting data points within specific subsections or windows of the data. These methods typically employ local regression or averaging techniques to estimate migration intensities at each age based on the data from neighboring ages.</p>
<p>Choosing an appropriate bandwidth or window size is crucial in smoothing age-specific migration data. The bandwidth determines the range of nearby ages considered for each estimation and influences the level of smoothing applied. The default bandwidth values for the smoothing functions in R might not always be suitable for migration age schedules, as the underlying patterns and variability can vary across different contexts and the smoothing functions are more typically applied to much larger data sets (as opposed to 100 or so age groups in the age-specific migration data).</p>
<p>In some cases, it may be necessary to censor or exclude the very oldest age groups from the smoothing process. This is because migration intensities for these age groups can become volatile and unreliable due to small numbers of migrants. By removing these extreme values, the smoothing methods can provide more stable and meaningful estimates of migration patterns across the age range.</p>
<p>An example of the unevenness in observed age-specific migration data can be found in the <code>ipumsi_age</code> data frame of the <em>migest</em> package. The data in the object are based on census samples from Brazil 2000 and France 2006 published in the IPUMS International repository (<span class="citation" data-cites="ipums2015">(<a href="references.html#ref-ipums2015" role="doc-biblioref"><strong>ipums2015?</strong></a>)</span>). The data frame contains a variable <code>migrants</code> on the population weighted counts of persons who migrated between any minor (and major) administrative units determined from responses to questions on place of residence five-years prior to the census. The migration intensities are particularly uneven at the elderly age groups in the sample from the Brazil 2000 census.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-12_50b6715fdac6d14f46bc2c0665e95934">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ipumsi_age</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mi <span class="op">=</span> <span class="va">migrants</span><span class="op">/</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span>facets <span class="op">=</span> <span class="st">"sample"</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Most smoothing functions in R typically require two vectors: <code>x</code> and <code>y</code>. The <code>x</code> vector represents the independent variable, such as age, and the <code>y</code> vector represents the dependent variable, such as migration intensity. These functions often have optional arguments that allow you to control the smoothness of the fit, although the names of these arguments may vary depending on the specific smoothing function.</p>
<p>When applying a smoothing function, it will return a list with two components: <code>x</code> and <code>y</code>. It’s important to note that the length of the <code>x</code> vector may differ from the original vector provided. To control the output length, some smoothing functions offer arguments (with different names depending on the function) that allow you to specify the desired length of the output. The <code>x</code> component of the output will match the age values, while the <code>y</code> component will represent the smoothed values of the dependent variable.</p>
<section id="kernal-smoothing" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="kernal-smoothing">
<span class="header-section-number">6.4.1</span> Kernal Smoothing</h3>
<p>The <code><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth()</a></code> function in the <code>stats</code> package performs kernel regression smoothing. It estimates a smooth curve by applying a kernel weighting to nearby data points, allowing for flexible and localized smoothing. To demonstrate we will use the migration intensities calculated from the Brazil 2000 IPUMS International sample provided in the <code>ipums_age</code> data frame. Note, there are no intensities for ages below five as the question on previous place of residence five-years prior to the census was not applicable for the sub population.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-13_721c32b9af3932a78634e7fa419df668">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bra_2000</span> <span class="op">&lt;-</span> <span class="va">ipumsi_age</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sample</span> <span class="op">==</span> <span class="st">"BRA2000"</span>,</span>
<span>         <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mi <span class="op">=</span> <span class="va">migrants</span><span class="op">/</span><span class="va">population</span><span class="op">)</span></span>
<span><span class="va">bra_2000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 95 × 5
   sample    age migrants population     mi
   &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
 1 BRA2000     6  355723.   3311728. 0.107 
 2 BRA2000     7  343852.   3307567. 0.104 
 3 BRA2000     8  327166.   3258046. 0.100 
 4 BRA2000     9  314905.   3272305. 0.0962
 5 BRA2000    10  324066.   3345583. 0.0969
 6 BRA2000    11  329525.   3451739. 0.0955
 7 BRA2000    12  327113.   3518160. 0.0930
 8 BRA2000    13  323180.   3473133. 0.0931
 9 BRA2000    14  334783.   3566239. 0.0939
10 BRA2000    15  337297.   3528845. 0.0956
# … with 85 more rows</code></pre>
</div>
</div>
<p>We can use the <code>n.points</code> argument in the <code><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth()</a></code> function to fix the length of the smoothed points returned by the object.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-14_43c89250eafe5042b520c31bd5ec0597">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># default returns 100 values. corresponding ages in x no longer integers</span></span>
<span><span class="va">k1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bra_2000</span><span class="op">$</span><span class="va">age</span>, y <span class="op">=</span> <span class="va">bra_2000</span><span class="op">$</span><span class="va">mi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">k1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ x: num [1:100] 6 6.95 7.9 8.85 9.8 ...
 $ y: num [1:100] 0.1074 0.104 0.1004 0.0962 0.0969 ...</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># return only 95 values to match the number of age groups in the data</span></span>
<span><span class="va">k2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bra_2000</span><span class="op">$</span><span class="va">age</span>, y <span class="op">=</span> <span class="va">bra_2000</span><span class="op">$</span><span class="va">mi</span>, n.points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bra_2000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">k2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ x: num [1:95] 6 7 8 9 10 11 12 13 14 15 ...
 $ y: num [1:95] 0.1074 0.104 0.1004 0.0962 0.0969 ...</code></pre>
</div>
</div>
<p>The <code><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth()</a></code> function is unlikely to smooth a migration age schedule as the default bandwidth parameter is too small for one hundred odd age groups. The <code>bandwidth</code> parameter can be increased to provide a more suitable fit</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-15_1d596f3e4d2ca647088f0fd4f08ef0fc">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bra_2000</span> <span class="op">&lt;-</span> <span class="va">bra_2000</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    k_default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, n.points <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    k_5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, n.points <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, bandwidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    k_10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, n.points <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, bandwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">bra_2000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 95 × 8
   sample    age migrants population     mi k_default    k_5   k_10
   &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 BRA2000     6  355723.   3311728. 0.107     0.107  0.104  0.100 
 2 BRA2000     7  343852.   3307567. 0.104     0.104  0.102  0.0990
 3 BRA2000     8  327166.   3258046. 0.100     0.100  0.101  0.0983
 4 BRA2000     9  314905.   3272305. 0.0962    0.0962 0.0986 0.0978
 5 BRA2000    10  324066.   3345583. 0.0969    0.0969 0.0964 0.0976
 6 BRA2000    11  329525.   3451739. 0.0955    0.0955 0.0949 0.0978
 7 BRA2000    12  327113.   3518160. 0.0930    0.0930 0.0944 0.0975
 8 BRA2000    13  323180.   3473133. 0.0931    0.0931 0.0942 0.0982
 9 BRA2000    14  334783.   3566239. 0.0939    0.0939 0.0950 0.100 
10 BRA2000    15  337297.   3528845. 0.0956    0.0956 0.0973 0.103 
# … with 85 more rows</code></pre>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bra_2000</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"k_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"bandwidth"</span>, names_prefix <span class="op">=</span> <span class="st">"k_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">bandwidth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mi</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="loess-smoothing" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="loess-smoothing">
<span class="header-section-number">6.4.2</span> Loess Smoothing</h3>
<p>The <code>stats</code> package also contains another smoothing function; <code><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth()</a></code>, which carries out local polynomial regression fitting. It fits a smooth curve to the data using a weighted least squares approach, with the degree of smoothing controlled by a <code>span</code> tuning parameter. The <code><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth()</a></code> function, similar to the <code><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth()</a></code> function, may not be suitable for smoothing a migration age schedule using the default parameters. The default value of the <code>span</code> parameter, which controls the smoothness of the fit, is often too large for applying to migration age schedules. Additionally, the <code>evaluation</code> parameter specifies the number of predicted values by default as 50.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-16_39cf2aa82df91c346777282c8a205586">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bra_2000</span> <span class="op">&lt;-</span> <span class="va">bra_2000</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    lo_default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, evaluation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    lo_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, evaluation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, span <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    lo_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, evaluation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, span <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">bra_2000</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"lo_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"span"</span>, names_prefix <span class="op">=</span> <span class="st">"lo_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">span</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mi</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="cubic-spline-smoothing" class="level3" data-number="6.4.3"><h3 data-number="6.4.3" class="anchored" data-anchor-id="cubic-spline-smoothing">
<span class="header-section-number">6.4.3</span> Cubic Spline smoothing</h3>
<p>Cubic spline smoothing is another popular method for smoothing data, including migration age schedules. It provides a flexible and smooth curve by connecting cubic polynomials between data points. In R, the <code><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline()</a></code> function in the <em>stats</em> package can be used to perform cubic spline smoothing. The function allows you to control the smoothness of the fit using the <code>spar</code> parameter (between 0 and 1), which determines the amount of smoothing applied. A smaller <code>spar</code> value results in a smoother fit, while a larger value allows for more flexibility and potential for capturing local variations in the data. The number of predicted smoothed</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-17_95f04f1a069c3db26e1229bf212d11b8">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bra_2000</span> <span class="op">&lt;-</span> <span class="va">bra_2000</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    s_default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    s_6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, spar <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    s_8 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mi</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, spar <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">bra_2000</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"s_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"spar"</span>, names_prefix <span class="op">=</span> <span class="st">"s_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">spar</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mi</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As with each of the earlier smoothing methods, it’s important to experiment with smoothing parameter (<code>spar</code>, <code>span</code> in <code><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth()</a></code> and <code>bandwidth</code> in <code><a href="https://rdrr.io/r/stats/ksmooth.html">ksmooth()</a></code>) to evaluate the resulting smoothed migration age schedule visually to determine the optimal level of smoothing for your requirements.</p>
</section></section><section id="graduating" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="graduating">
<span class="header-section-number">6.5</span> Graduating</h2>
<p>When faced with migration data reported in age groups instead of single-year data, graduating methods can be employed to estimate migration for each individual age. These methods aim to distribute the reported age group totals across the corresponding ages in a way that maintains consistency and ensures that the graduated values sum up to the reported totals.</p>
<p>One useful tool for performing the graduation process is the <code><a href="https://rdrr.io/pkg/DemoTools/man/graduate.html">graduate()</a></code> function in the DemoTools package. While originally designed for interpolating population totals, it is also suitable for estimating migration flows. The function offers several graduating methods, each with its own approach and assumptions. For a comprehensive understanding of these methods, you can refer to the guide provided <a href="https://timriffe.github.io/DemoTools/articles/graduation_with_demotools.html">here</a>.</p>
<p>To utilize the <code><a href="https://rdrr.io/pkg/DemoTools/man/graduate.html">graduate()</a></code> function, you need to provide the reported values (<code>Value</code>) and specify the minimum age (<code>Age</code>) for which the data is available. Additionally, for certain methods like <code>pclm</code>, you can specify the maximum value for the final open age group if it exists. By applying the appropriate graduating method, you can obtain estimates of migration for each individual year based on the available age group data.</p>
<p>To demonstrate we will use internal migration data in Italy contained in the <code>italy_area</code> data set in the <em>migest</em> package. In particular we will use the age-specific out migration counts from the Islands regions, which can be derived from using the <code><a href="http://guyabel.github.io/migest/reference/sum_region.html">sum_region()</a></code> function</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-18_9613242646447016a83a3c9d8b0623fb">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ita_reg</span> <span class="op">&lt;-</span> <span class="va">italy_area</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">age_grp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="http://guyabel.github.io/migest/reference/sum_region.html">sum_region</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"age_grp"</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age_min"</span>, <span class="st">"age_max"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ita_reg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 700 × 8
# Groups:   year [7]
    year age_min age_max region     out_mig in_mig  turn   net
   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1970       0       4 Center        5634   8087 13721  2453
 2  1970       0       4 Islands       7876   4532 12408 -3344
 3  1970       0       4 North-East    4973   5760 10733   787
 4  1970       0       4 North-West   11777  18873 30650  7096
 5  1970       0       4 South        15422   8430 23852 -6992
 6  1970       5       9 Center        4726   7448 12174  2722
 7  1970       5       9 Islands       7271   3592 10863 -3679
 8  1970       5       9 North-East    4172   5327  9499  1155
 9  1970       5       9 North-West    9530  17719 27249  8189
10  1970       5       9 South        14745   6358 21103 -8387
# … with 690 more rows</code></pre>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">isl_1970</span> <span class="op">&lt;-</span> <span class="va">ita_reg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1970</span>,</span>
<span>         <span class="va">region</span> <span class="op">==</span> <span class="st">"Islands"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we apply the <code>pclm</code> method we tell the <code><a href="https://rdrr.io/pkg/DemoTools/man/graduate.html">graduate()</a></code> function that the last age group is open and set a new maximum value of 100.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-19_b179890f152cee938bd3c881ebf5aa9d">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># # install devtools from CRAN</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="co"># # install DemoTools from github</span></span>
<span><span class="co"># devtools::install_github("timriffe/DemoTools")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DemoTools</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'DemoTools'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:rcbayes':

    mig_calculate_rc, mig_estimate_rc</code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DemoTools/man/graduate.html">graduate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">isl_1970</span><span class="op">$</span><span class="va">out_mig</span>, Age <span class="op">=</span> <span class="va">isl_1970</span><span class="op">$</span><span class="va">age_min</span>,</span>
<span>              method <span class="op">=</span> <span class="st">"pclm"</span>, OAG <span class="op">=</span>  <span class="cn">TRUE</span>, OAnew <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">g</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          0           1           2           3           4           5 
1540.822616 1563.081967 1582.487050 1594.810184 1594.859870 1576.283303 
          6           7           8           9          10          11 
1534.233098 1470.025351 1388.679355 1301.771896 1221.108012 1158.023181 
         12          13          14          15          16          17 
1121.942083 1119.554144 1158.435391 1247.103598 1398.284195 1623.913611 
         18          19          20          21          22          23 
1935.092918 2321.755623 2741.539266 3112.329630 3324.796748 3324.915552 
         24          25          26          27          28          29 
3125.320990 2812.139216 2482.216694 2189.772149 1958.656025 1781.415216 
         30          31          32          33          34          35 
1641.408137 1521.553492 1407.170481 1293.744997 1182.104397 1077.109503 
         36          37          38          39          40          41 
 984.353885  906.668010  845.151088  798.771354  765.545510  742.411329 
         42          43          44          45          46          47 
 725.616964  710.186702  690.289756  660.651697  617.401802  562.289211 
         48          49          50          51          52          53 
 501.033932  441.541294  391.355174  354.054434  330.929904  320.470746 
         54          55          56          57          58          59 
 319.333087  323.280116  326.437894  324.340533  314.694694  298.140366 
         60          61          62          63          64          65 
 278.157544  258.006157  240.321118  226.037262  214.561457  204.846583 
         66          67          68          69          70          71 
 195.376275  185.304981  174.609045  163.809589  153.997862  145.822900 
         72          73          74          75          76          77 
 139.398446  134.182156  128.693201  121.517548  111.497757   98.816336 
         78          79          80          81          82          83 
  85.271323   72.734621   62.959243   56.411258   52.462550   49.962470 
         84          85          86          87          88          89 
  46.549791   40.446619   31.418669   21.471299   13.559411    8.503983 
         90          91          92          93          94          95 
   5.890223    4.961916    5.352577    7.481251   12.438906   21.715730 
         96          97          98          99         100 
  32.832828   36.073090   26.875823   13.368895    4.891892 </code></pre>
</div>
</div>
<p>When we plot the observed age schedule besides the graduated age schedule we see the drop in the relative scales of the single-year data, which are constrained to match the observed five-year out-migraiton totals.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-20_03736c1c447248ea44a697edbfff6d85">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">isl_1970</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_min</span> <span class="op">+</span> <span class="fl">2.5</span>, y <span class="op">=</span> <span class="va">out_mig</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, mx <span class="op">=</span> <span class="va">g</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-age_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graduation of the five-year migration counts to single-year counts can be seen by inspecting the sum of the first five estimated values in the <code>g</code> object and the obeseverd data for the out migration of the 0-4 year olds.</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-21_e5d945dacac434ae14040cea7751af73">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 0-4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># 5-9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">isl_1970</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="migraiton-age-indices" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="migraiton-age-indices">
<span class="header-section-number">6.6</span> Migraiton Age Indices</h2>
<p>Index measures for age-specific migration schedules can be used to summarizing and comparing migration age profiles. They provide a concise representation of age-specific migration rates, enabling researchers to identify distinctive features and variations in the age dynamics of migration patterns across populations or over time.</p>
<p>There are two main families of index measures for migration age schedules. The first uses relationships between fitted parameters of a Rogers-Castro migration age schedules. The second uses empirical measures based on either the observed or smoothed age-specific migration data.</p>
<section id="rogers-and-castro-parameter-relationships" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="rogers-and-castro-parameter-relationships">
<span class="header-section-number">6.6.1</span> Rogers and Castro Parameter Relationships</h3>
<p><span class="citation" data-cites="Rogers1981">(<a href="references.html#ref-Rogers1981" role="doc-biblioref"><strong>Rogers1981?</strong></a>)</span> highlighted the significance of the relationships between certain parameters in the model age schedules. These relationships can provide insights into important characteristics of migration patterns and can guide the derivation of customized model schedules. Four key measures, namely peaking, dominance, labor asymmetry, and regularity, were highlighted.</p>
<p>Peaking refers to the timing of the peak migration age, indicating whether migration rates peak at an earlier or later age. In the fundamental parameters proposed by Rogers and Castro, the parameter <span class="math inline">\(\mu_2\)</span> is set to 20, representing a age where with the highest migration rates.</p>
<p>Dominance, is captured by the relationship <span class="math inline">\(\gamma_{12} = a_1/a_2\)</span>, which represents the ratio of migration rates between two specific age groups. It serves as an index of child dependency in the migration age patterns, with the inverse <span class="math inline">\(1/\gamma_{12}\)</span> reflecting the index of labor dominance. In the fundamental parameters, <span class="math inline">\(\gamma_{12} = 1/3\)</span>.</p>
<p>Labor asymmetry is measured by the relationship <span class="math inline">\(\sigma_2 = \lambda_2/\alpha_2\)</span>, representing the ratio of two parameters used for the upward and downward parts of the labour force curve in the age schedule. In the fundamental parameters, <span class="math inline">\(\sigma_2 = 4\)</span> indicating a faster (by four times) rise in the curve before the peak than the decline after the peak.</p>
<p>Finally, regularity is assessed through the relationship <span class="math inline">\(\beta_{12} = \alpha_1/\alpha_2\)</span>, which compares the migration rates of parents and children. A value of <span class="math inline">\(\beta_{12} = 1\)</span>, as in the fundamental parameters, indicates a regular pattern where the migration rates of children closely match those of their parents.</p>
<p>The <code><a href="http://guyabel.github.io/migest/reference/index_age_rc.html">index_age_rc()</a></code> function in the <em>migest</em> package returns these ratios given a named vector of the parameters. For example, we can see the disussed values in the fundamental parameters:</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-22_ba708827827c62b2b97c75b27b4297f4">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rc_model_fund</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="http://guyabel.github.io/migest/reference/index_age_rc.html">index_age_rc</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  measure           value
  &lt;chr&gt;             &lt;dbl&gt;
1 peaking          20    
2 child_dependency  0.333
3 labor_dependency  3    
4 labor_asymmetry   4    
5 regularity        1    </code></pre>
</div>
</div>
<p>More practically, we can also compare migration age schedules using the relationships between the parameter estimates. To demonstrate we fit a Rogers-Castro migration age schedule for female immigrants to Cyprus during 2011:</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-23_1574cd4c86de58a71c65718091883367">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_cy_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, </span>
<span>                     mx <span class="op">=</span> <span class="va">imm_cy_2011</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">mx</span><span class="op">)</span>,</span>
<span>                     pre_working_age <span class="op">=</span> <span class="cn">TRUE</span>, working_age <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     retirement <span class="op">=</span> <span class="cn">FALSE</span>, post_retirement <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.000102 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.02 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1.558 seconds (Warm-up)
Chain 1:                1.109 seconds (Sampling)
Chain 1:                2.667 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 6.1e-05 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.61 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1.517 seconds (Warm-up)
Chain 2:                1.237 seconds (Sampling)
Chain 2:                2.754 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 4.5e-05 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.45 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 1.471 seconds (Warm-up)
Chain 3:                1.092 seconds (Sampling)
Chain 3:                2.563 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 4.6e-05 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.46 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 1.553 seconds (Warm-up)
Chain 4:                1.32 seconds (Sampling)
Chain 4:                2.873 seconds (Total)
Chain 4: </code></pre>
</div>
</div>
<p>We can then combine the parameter estimates for the male and female fitted Rogers-Castro migration age schedules and apply the <code><a href="http://guyabel.github.io/migest/reference/index_age_rc.html">index_age_rc()</a></code> function:</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-24_588bf0b9139f9947d52b939d6b7126d7">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span>,</span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">f_cy_male</span><span class="op">$</span><span class="va">pars_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">median</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           <span class="va">f_cy_female</span><span class="op">$</span><span class="va">pars_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">median</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rc_index <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">p</span>, .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="http://guyabel.github.io/migest/reference/index_age_rc.html">index_age_rc</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">.x</span>, long <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">rc_index</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  sex    p         peaking child_dependency labor_dependency labor_asy…¹ regul…²
  &lt;chr&gt;  &lt;list&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;
1 male   &lt;dbl [7]&gt;    21.1            0.201             4.98        3.80   0.574
2 female &lt;dbl [7]&gt;    24.1            0.127             7.85        1.91   0.573
# … with abbreviated variable names ¹​labor_asymmetry, ²​regularity</code></pre>
</div>
</div>
<p>The calculations indicate a later peak age and lower levels of asymmetry in the female immigration flows compared to the male counterparts.</p>
</section><section id="emprical-age-indices" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="emprical-age-indices">
<span class="header-section-number">6.6.2</span> Emprical Age Indices</h3>
<p>Model age schedules for migration have faced several criticisms, see for example <span class="citation" data-cites="Bell2002">(<a href="references.html#ref-Bell2002" role="doc-biblioref"><strong>Bell2002?</strong></a>)</span> or <span class="citation" data-cites="Bernard2014">(<a href="references.html#ref-Bernard2014" role="doc-biblioref"><strong>Bernard2014?</strong></a>)</span>. One significant challenge is the lack of consensus on the appropriate number of parameters to include in a model schedule. Different model forms can yield varying parameter estimates, making comparisons across studies or time periods challenging. To address this issue, statistical accuracy measures are sometimes used to select the best model form, although this can risk overfitting the data.</p>
<p>Another concern is the sensitivity of parameter estimates to the choice of initial values. However, when using the <code><a href="https://rdrr.io/pkg/DemoTools/man/mig_estimate_rc.html">mig_estimate_rc()</a></code> function, this issue is mitigated as the estimation process relies on MCMC sampling which discards the first few thousand iterations in the estimation procedure. Unstable parameter estimates in Roger-Castro migration age schedules can arise due to measurement error in age-specific migration data. This instability can affect the reliability and robustness of the estimated parameters, making it challenging to draw firm conclusions from the results. Furthermore, the interpretation of parameter estimates, particularly the indexes in <code><a href="http://guyabel.github.io/migest/reference/index_age_rc.html">index_age_rc()</a></code>, has not been widely adopted. This is likely due to the difficulty in fitting model schedules accurately, resulting in skepticism regarding the practical usefulness of these indexes.</p>
<p>Several alternative measures of age-specific migration have been proposed that do not involve fitting model age schedules. These measures often rely on the migration intensity, which is the number of migrants in a specific age group and time period as a percentage of the population at risk of moving.</p>
<p>One such measure is the Gross Migraproduction Rate (GMR) proposed by <span class="citation" data-cites="Rogers1975">(<a href="references.html#ref-Rogers1975" role="doc-biblioref"><strong>Rogers1975?</strong></a>)</span>. The GMR is calculated as the sum of age-specific migration intensities, <span class="math inline">\(m(x)\)</span>, taking into. It provides a measure of the overall migration intensity in a given population by aggregating the migration rates across different age groups.</p>
<p><span class="math display">\[
\texttt{GMR} = \sum_{x} m(x)
\]</span></p>
<p><span class="citation" data-cites="Bell2002">(<a href="references.html#ref-Bell2002" role="doc-biblioref"><strong>Bell2002?</strong></a>)</span> introduced two additional measures. The first is the peak migration intensity, which identifies the age group with the highest migration intensity. The second measure is the peak age, which corresponds to the age at which the peak migration intensity occurs (in the data rather than a fitted age scheule as used in the previous section).</p>
<p><span class="citation" data-cites="Bell2009">(<a href="references.html#ref-Bell2009" role="doc-biblioref"><strong>Bell2009?</strong></a>)</span> proposed additional measures to further analyze age-specific migration patterns. The first measure is the breadth of the peak, which considers the sum of the peak migration intensity at the peak age and the five age-groups before and after the peak. This measure provides insights into the width or spread of the migration peak, indicating the range of ages where migration is concentrated.</p>
<p>The second measure introduced by <span class="citation" data-cites="Bell2009">(<a href="references.html#ref-Bell2009" role="doc-biblioref"><strong>Bell2009?</strong></a>)</span> is the peak share, which calculates the percentage of the normalized migration age schedule covered by the peak age and the five age-groups before and after the peak. This measure provides an indication of the relative importance and concentration of migration in the peak age range compared to the entire age distribution.</p>
<p><span class="citation" data-cites="Bernard2014">(<a href="references.html#ref-Bernard2014" role="doc-biblioref"><strong>Bernard2014?</strong></a>)</span> proposed three additional measures that focus on the labor force peak. The first measure is the Maximum Upward Rate of Change (MURC), which identifies the largest gradient in the slope of the labor force peak before the peak age. This measure captures the steepest increase in migration intensity leading up to the labor force peak.</p>
<p>The second measure is the Maximum Downward Rate of Change (MDRC), which identifies the largest gradient in the slope of the labor force peak after the peak age. This measure captures the steepest decrease in migration intensity following the labor force peak.</p>
<p>The third measure introduced by Bernard <span class="citation" data-cites="Bernard2014">(<a href="references.html#ref-Bernard2014" role="doc-biblioref"><strong>Bernard2014?</strong></a>)</span> is the asymmetry of the labor force peak, which is determined by the ratio of MURC and MDRC. This measure quantifies the asymmetry or imbalance in the migration intensity before and after the peak age.</p>
<p>All of these measures, including the breadth of the peak, peak share, MURC, MDRC, and asymmetry, are calculated in the <code>age_index()</code> function in the <em>migest</em> package. <span class="citation" data-cites="Bernard2014">(<a href="references.html#ref-Bernard2014" role="doc-biblioref"><strong>Bernard2014?</strong></a>)</span> recommends smoothing age schedules before calculating the index values. However, if the data is not extremely rough then very similar calculated values will be obtained as the <code><a href="http://guyabel.github.io/migest/reference/index_age.html">index_age()</a></code> function ignores by default values above 65 (and below 5) when calculating peak index statistics. The one exception to the sensitivity to the smoothness in the data is the <code>GMR</code> which is based on all ages, where, as seen earlier in some of the eldest age groups, the observed values might be very small (oldest in Brazil).</p>
<div class="cell" data-hash="05-age_cache/html/unnamed-chunk-25_0d1236db02922ded35a7ea0987690813">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ipumsi_age</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mi <span class="op">=</span> <span class="va">migrants</span><span class="op">/</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="va">sample</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>index_age <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">data</span>, .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="http://guyabel.github.io/migest/reference/index_age.html">index_age</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">.x</span>, long <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">index_age</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 10
  sample  data       gmr peak_mi peak_age peak_bre…¹ peak_…²  murc  mdrc asymm…³
  &lt;chr&gt;   &lt;list&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 BRA2000 &lt;tibble&gt;  7.71    14.3       24       143.    18.6    19    32   0.594
2 FRA2006 &lt;tibble&gt;  9.41    29.5       26       258.    27.4    18    30   0.6  
# … with abbreviated variable names ¹​peak_breadth, ²​peak_share, ³​asymmetry</code></pre>
</div>
</div>
<p>Notice the older peak migration intensity and ages in France 2006, where the breadth of the peak is wider a lower upward and downward rate of change.</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04-indices.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Summary Migration Indices</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>